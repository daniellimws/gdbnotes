<!doctype html><html lang=en><head><title>Syntax :: GDB Notes</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="GDB provides a simple yet powerful scripting interface that is very helpful while doing reverse engineering. A GDB script file can contain a collection of commands, used with the following constructs. Usually I call it GDB script, but apparently GDB docs calls them command files.
source &amp;lt;file&amp;gt; The file name/extension does not matter. A simple GDB script looks like this.
gdb gdbscript    set $sum=0 break *foo commands silent printf &amp;#34;Arg: %d\n&amp;#34;, $rdi set $sum=$sum&amp;#43;$rdi c end printf &amp;#34;Sum: %d\n&amp;#34;, $sum   To execute the script, simply call source ."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=/notes/scripting/scripting/syntax/><link rel=stylesheet href=/assets/style.css><link rel=stylesheet href=/assets/blue.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/img/favicon/blue.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Syntax"><meta property="og:description" content="GDB provides a simple yet powerful scripting interface that is very helpful while doing reverse engineering. A GDB script file can contain a collection of commands, used with the following constructs. Usually I call it GDB script, but apparently GDB docs calls them command files.
source &amp;lt;file&amp;gt; The file name/extension does not matter. A simple GDB script looks like this.
gdb gdbscript    set $sum=0 break *foo commands silent printf &amp;#34;Arg: %d\n&amp;#34;, $rdi set $sum=$sum&amp;#43;$rdi c end printf &amp;#34;Sum: %d\n&amp;#34;, $sum   To execute the script, simply call source ."><meta property="og:url" content="/notes/scripting/scripting/syntax/"><meta property="og:site_name" content="GDB Notes"><meta property="og:image" content="/img/favicon/blue.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="Scripting"><meta property="article:published_time" content="2020-05-08 00:00:00 +0000 UTC"></head><body class=blue><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>GDB Notes</div></a></div><div class=menu-trigger>menu</div></div></header><div class=content><div class=post><h1 class=post-title><span class=post-tags>Scripting&nbsp;</span>
<a href=/notes/scripting/scripting/syntax/>Syntax</a></h1><aside><nav id=TableOfContents><ul><li><a href=#source-file>source &lt;file></a></li><li><a href=#set-variablevalue>set $&lt;variable>=&lt;value></a></li><li><a href=#printf>printf</a></li><li><a href=#if>if</a></li><li><a href=#while>while</a></li><li><a href=#commands>commands</a><ul><li></li></ul></li></ul></nav></aside><div class=post-content><div><p>GDB provides a simple yet powerful scripting interface that is very helpful while doing reverse engineering. A GDB script file can contain a collection of commands, used with the following constructs. Usually I call it <em>GDB script</em>, but apparently GDB docs calls them <em>command files</em>.</p><h2 id=source-file>source &lt;file><a href=#source-file class=hanchor arialabel=Anchor>&#8983;</a></h2><p>The file name/extension does not matter. A simple GDB script looks like this.</p><div class=collapsable-code><input id=1 type=checkbox>
<label for=1><span class=collapsable-code__language>gdb</span>
<span class=collapsable-code__title>gdbscript</span>
<span class=collapsable-code__toggle data-label-expand=Show data-label-collapse=Hide></span></label><pre class=language-gdb><code>
set $sum=0

break *foo
commands
    silent
    printf &#34;Arg: %d\n&#34;, $rdi
    set $sum=$sum&#43;$rdi
    c
end

printf &#34;Sum: %d\n&#34;, $sum
</code></pre></div><p>To execute the script, simply call <code>source ./gdbscript</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> source ./commands2
Breakpoint <span style=color:#ae81ff>1</span> at 0x400497: file gdbscript.c, line 5.
Arg: <span style=color:#ae81ff>1</span>
Arg: <span style=color:#ae81ff>2</span>
Arg: <span style=color:#ae81ff>100</span>
<span style=color:#f92672>[</span>Inferior <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>process 1249<span style=color:#f92672>)</span> exited normally<span style=color:#f92672>]</span>
Sum: <span style=color:#ae81ff>103</span>
</code></pre></div><h2 id=set-variablevalue>set $&lt;variable>=&lt;value><a href=#set-variablevalue class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Variables. Created with this bash-like syntax.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> set $a<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> p $a
$1 <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> set $b<span style=color:#f92672>=</span>$rdi*8
<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> p $b
$2 <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> set $c<span style=color:#f92672>=</span>$a+$b
<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> p $c
$3 <span style=color:#f92672>=</span> <span style=color:#ae81ff>9</span>
</code></pre></div><blockquote><p><strong>Remember the <code>$</code>!</strong></p></blockquote><h2 id=printf>printf<a href=#printf class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Better printing than plain <code>p</code>. (Assuming that you already know how <code>printf</code> in C works)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> printf <span style=color:#e6db74>&#34;%d + %d = %d\n&#34;</span>, $a, $b, $c
<span style=color:#ae81ff>1</span> + 8 <span style=color:#f92672>=</span> <span style=color:#ae81ff>9</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> set $d<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;h&#39;</span>
<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> printf <span style=color:#e6db74>&#34;%c\n&#34;</span>, $d
h
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> x/s 0x00007fffffffe778
0x7fffffffe778:	<span style=color:#e6db74>&#34;LANGUAGE=en_US:en&#34;</span>
<span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> printf <span style=color:#e6db74>&#34;export %s\n&#34;</span>, 0x00007fffffffe778
export LANGUAGE<span style=color:#f92672>=</span>en_US:en
</code></pre></div><blockquote><p><strong>Remember to end with a <code>\n</code>!</strong></p></blockquote><h2 id=if>if<a href=#if class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Conditionals. <code>if-else-end</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#66d9ef>if</span> $rdi &gt; <span style=color:#ae81ff>10</span>
    printf <span style=color:#e6db74>&#34;Big: %d\n&#34;</span>, $rdi
<span style=color:#66d9ef>else</span>
    printf <span style=color:#e6db74>&#34;Small: %d\n&#34;</span>, $rdi
end
</code></pre></div><blockquote><p><code>else if</code> is not supported!</p></blockquote><h2 id=while>while<a href=#while class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Loops. GDB scripting interface only supports <code>while</code> loops.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>set $i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
<span style=color:#66d9ef>while</span> $i &lt; <span style=color:#ae81ff>3</span>
    set $i++
    printf <span style=color:#e6db74>&#34;i: %d\n&#34;</span>, $i

    <span style=color:#75715e># do stuff</span>
end
</code></pre></div><blockquote><p>Remember to do <code>set $i++</code>!</p></blockquote><h2 id=commands>commands<a href=#commands class=hanchor arialabel=Anchor>&#8983;</a></h2><p>To define commands when a breakpoint is hit. The <code>silent</code> command is very helpful to suppress GDB&rsquo;s output when a breakpoint is hit. The <code>commands</code> block can be ended with <code>cont</code>/<code>c</code>, <code>nexti</code>/<code>ni</code> or any other command that resumes execution.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>break *main
commands
    silent
    printf <span style=color:#e6db74>&#34;In main!\n&#34;</span>
    cont
end
</code></pre></div><p>Note that all commands defined after <code>cont</code>/<code>ni</code>/<code>si</code>/etc will be ignored. This is because there might be another breakpoint afterwards, and it will be ambigious for GDB to know which commands to execute.</p><p>For example, <code>printf "Continued\n"</code> in the following script will be ignored.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>break *main
commands
    silent
    printf <span style=color:#e6db74>&#34;In main!\n&#34;</span>
    cont
    printf <span style=color:#e6db74>&#34;Continued\n&#34;</span>
end
</code></pre></div><blockquote><p>To let the program continue execution after the breakpoint commands, remember to end the <code>commands</code> block with <code>cont</code>/<code>c</code>!</p></blockquote><h4 id=potential-mistake>Potential mistake<a href=#potential-mistake class=hanchor arialabel=Anchor>&#8983;</a></h4><p>The following example script does not work (using <strong>demo.c</strong>). Notice that the <code>commands</code> block does not end with <code>c</code>. One might expect the following script to hit the breakpoint 3 times, because of the <code>while</code> loop that calls <code>c</code> 3 times. However, it only hits once.</p><div class=collapsable-code><input id=4 type=checkbox checked>
<label for=4><span class=collapsable-code__language>c</span>
<span class=collapsable-code__title>demo.c</span>
<span class=collapsable-code__toggle data-label-expand=Show data-label-collapse=Hide></span></label><pre class=language-c><code>
// gcc -g demo.c -o demo -no-pie
#include &lt;stdio.h&gt;

void foo(int a)
{
}

int main()
{
    foo(1);
    foo(2);
    foo(100);

    return 0;
}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>set $sum<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>

break *foo
commands
    printf <span style=color:#e6db74>&#34;Arg: %d\n&#34;</span>, $rdi
    set $sum+<span style=color:#f92672>=</span>$rdi
end

r

set $i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
<span style=color:#66d9ef>while</span> $i &lt; <span style=color:#ae81ff>3</span>
    c
    set $i++
    printf <span style=color:#e6db74>&#34;i: %d\n&#34;</span>, $i
end

printf <span style=color:#e6db74>&#34;Sum: %d\n&#34;</span>, $sum
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> source ./commands
Breakpoint <span style=color:#ae81ff>1</span> at 0x400497: file gdbscript.c, line 5.
Arg: <span style=color:#ae81ff>1</span>
i: <span style=color:#ae81ff>1</span>
i: <span style=color:#ae81ff>2</span>
<span style=color:#f92672>[</span>Inferior <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>process 1157<span style=color:#f92672>)</span> exited normally<span style=color:#f92672>]</span>
i: <span style=color:#ae81ff>3</span>
Sum: <span style=color:#ae81ff>1</span>
</code></pre></div><p>The breakpoint command (<code>printf "Arg: %d\n", $rdi</code>) is only executed once, although we can see that the while loop has ran 3 times (as <code>i</code> is printed from 1 to 3).</p><p>Now, consider this script without the <code>while</code> loop, and the <code>commands</code> block ending with <code>c</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>set $sum<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>

break *foo
commands
    silent
    printf <span style=color:#e6db74>&#34;Arg: %d\n&#34;</span>, $rdi
    set $sum+<span style=color:#f92672>=</span>$rdi
    c
end

r

printf <span style=color:#e6db74>&#34;Sum: %d\n&#34;</span>, $sum
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>(</span>gdb<span style=color:#f92672>)</span> source ./commands2
Breakpoint <span style=color:#ae81ff>1</span> at 0x400497: file gdbscript.c, line 5.
Arg: <span style=color:#ae81ff>1</span>
Arg: <span style=color:#ae81ff>2</span>
Arg: <span style=color:#ae81ff>100</span>
<span style=color:#f92672>[</span>Inferior <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>process 1249<span style=color:#f92672>)</span> exited normally<span style=color:#f92672>]</span>
Sum: <span style=color:#ae81ff>103</span>
</code></pre></div><p>This time, the breakpoint is hit at every call to <code>foo</code>.</p><p>I&rsquo;m not sure about the exact underlying behaviour, but moral of the story: just don&rsquo;t manually <code>continue</code> when breakpoint commands are defined, to avoid unnecessary headache.</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/notes/basics/basics/inspecting/><span class=button__icon>←</span>
<span class=button__text>Inspecting</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2021 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script></div></body></html>